{% include "header.html" %}
<script src="{{ url_for('static', filename='assets/js/Chart.min.js') }}" type="text/javascript"></script>

<!--link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"-->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">

 <div class="content" style="font-size:18px;">
                <div class="container-fluid">
                    <div class="row">
                        <div class="md-8" style="margin-top:-45px;">
                            <div class="card">
                                <div class="card-header card-header-icon" data-background-color="purple">
                                    <i class="material-icons">assignment</i>
                                </div>
                                <div class="card-content">
                                    <h4 class="card-title"><b>Attendance</b></h4>
                                    <div class="toolbar">
                                        <!--        Here you can write extra buttons/actions for the toolbar              -->
                                    </div><input type="hidden" id="maxindex" value="">
                                    <div class="material-datatables">
                                        <table id="datatables" class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%; text-transform:capitalize; text-size:-5px;">
                                            <thead>
                                                <tr>
                                                     <th style="font-size:20px;" class="col-sm-3 "><b>Course</b></th>
                                                     <th style="font-size:20px;" class="col-sm-3 "><b>First Name</b></th>
                                                     <th style="font-size:20px;" class="col-sm-3 "><b>Last Name</b></th>
                                                     <th style="font-size:20px;" class="col-sm-3 "><b>Attended</b></th>
                                                </tr>
                                            </thead>

                                            <tbody>
												{% for item in data %}
                                                {% if loop.index > 0 %}
                                                  <script>$('#maxindex').val('{{ item[4] }}');</script>
                                                {% endif %}
                                                <tr>
                                                    <td>{{ item[0] }}</td>
                                                    <td>{{ item[2] }}</td>
													<td>{{ item[3] }}</td>
                                                    <td>
                                                        {{ item[4] }}
                                                    </td>
                                                </tr>
												{% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    <hr>
<form name="ffk3" method="post" action="">
                         <div class="row-md">
                            <b> Course Name :</b> <input type="text" name="group" value="">
                             <br>
                             <br>
                            <b> Start Date :</b> <input type="date" name="startdate">
                             <br>
                             <br>
                            <b> End Date :</b> <input type="date" name="enddate">
                             <br>
                             <br>
                            <b> <input class="btn btn-primary btn-sm" type="submit" name="filter" value="Filter"></b>
                             <br>
                             <br>
                         </div>
                        </form>
                                </div>
                                <!-- end content-->

                            </div>
                            <!--  end card  -->

                        </div>
                        <!-- end col-md-12 -->

                        {% if data %}
                        <div class="md-8">
                            <div class="card">
                        <div id="chart-container">
                          <canvas id="graphCanvas"></canvas>
                        </div>
                                </div>
                        </div>
                        {% endif %}

                    </div>
                    <!-- end row -->
                </div>
            </div>





<!--   Core JS Files   -->
<!--script src="{{ url_for('static', filename='assets/js/jquery-3.2.1.min.js') }}" type="text/javascript"></script-->
<script src="{{ url_for('static', filename='assets/js/bootstrap.min.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='assets/js/material.min.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='assets/js/perfect-scrollbar.jquery.min.js') }}" type="text/javascript"></script>
<!-- Include a polyfill for ES6 Promises (optional) for IE11, UC Browser and Android browser support SweetAlert -->
<script src="../../../../cdnjs.cloudflare.com/ajax/libs/core-js/2.4.1/core.js"></script>
<!-- Library for adding dinamically elements -->
<script src="{{ url_for('static', filename='assets/js/arrive.min.js') }}" type="text/javascript"></script>
<!-- Forms Validations Plugin -->
<script src="{{ url_for('static', filename='assets/js/jquery.validate.min.js') }}"></script>
<!--  Plugin for Date Time Picker and Full Calendar Plugin-->
<script src="{{ url_for('static', filename='assets/js/moment.min.js') }}"></script>
<!--  Charts Plugin, full documentation here: https://gionkunz.github.io/chartist-js/ -->
<script src="{{ url_for('static', filename='assets/js/chartist.min.js') }}"></script>
<!--  Plugin for the Wizard, full documentation here: https://github.com/VinceG/twitter-bootstrap-wizard -->
<script src="{{ url_for('static', filename='assets/js/jquery.bootstrap-wizard.js') }}"></script>
<!--  Notifications Plugin, full documentation here: http://bootstrap-notify.remabledesigns.com/    -->
<script src="{{ url_for('static', filename='assets/js/bootstrap-notify.js') }}"></script>
<!--   Sharrre Library    -->
<script src="{{ url_for('static', filename='assets/js/jquery.sharrre.js') }}"></script>
<!--  Plugin for the DateTimePicker, full documentation here: https://eonasdan.github.io/bootstrap-datetimepicker/ -->
<script src="{{ url_for('static', filename='assets/js/bootstrap-datetimepicker.js') }}"></script>
<!-- Vector Map plugin, full documentation here: http://jvectormap.com/documentation/ -->
<script src="{{ url_for('static', filename='assets/js/jquery-jvectormap.js') }}"></script>
<!-- Sliders Plugin, full documentation here: https://refreshless.com/nouislider/ -->
<script src="{{ url_for('static', filename='assets/js/nouislider.min.js') }}"></script>
<!--  Google Maps Plugin    -->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD1_8C5Xz9RpEeJSaJ3E_DeBv8i7j_p6Aw"></script>
<!--  Plugin for Select, full documentation here: http://silviomoreto.github.io/bootstrap-select -->
<script src="{{ url_for('static', filename='assets/js/jquery.select-bootstrap.js') }}"></script>
<!--  DataTables.net Plugin, full documentation here: https://datatables.net/    -->
<script src="{{ url_for('static', filename='assets/js/jquery.datatables.js') }}"></script>
<!-- Sweet Alert 2 plugin, full documentation here: https://limonte.github.io/sweetalert2/ -->
<script src="{{ url_for('static', filename='assets/js/sweetalert2.js') }}"></script>
<!-- Plugin for Fileupload, full documentation here: http://www.jasny.net/bootstrap/javascript/#fileinput -->
<script src="{{ url_for('static', filename='assets/js/jasny-bootstrap.min.js') }}"></script>
<!--  Full Calendar Plugin, full documentation here: https://github.com/fullcalendar/fullcalendar    -->
<script src="{{ url_for('static', filename='assets/js/fullcalendar.min.js') }}"></script>
<!-- Plugin for Tags, full documentation here: https://github.com/bootstrap-tagsinput/bootstrap-tagsinputs  -->
<script src="{{ url_for('static', filename='assets/js/jquery.tagsinput.js') }}"></script>
<!-- Material Dashboard javascript methods -->
<script src="{{ url_for('static', filename='assets/js/material-dashboard23cd.js') }}"></script>
<!-- Material Dashboard DEMO methods, don't include it in your project! -->
<script src="{{ url_for('static', filename='assets/js/demo.js') }}"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script type="text/javascript" language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script type="text/javascript" language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>

<script type="text/javascript">
    {% if session.user_role == 'teacher' %}
    $(document).ready(function() {
        $('#datatables').DataTable({
            dom: 'Bfrtip',
        buttons: [{
            extend: 'excel',
text : 'Download Attendance',
{% endif %}
filename: function(){
                var d = new Date();
                var n = d.getTime();
                var f = $('#maxindex').val();
                return 'attendance ' + f;
            },
        }],
            "pagingType": "full_numbers",
            "lengthMenu": [
                [10, 25, 50, -1],
                [10, 25, 50, "All"]
            ],
            responsive: true,
            language: {
                search: "_INPUT_",
                searchPlaceholder: "Search records",
            }
        });


        var table = $('#datatables').DataTable();

        // Edit record
        table.on('click', '.edit', function() {
            $tr = $(this).closest('tr');

            var data = table.row($tr).data();
            //alert('You press on Row: ' + data[0] + ' ' + data[1] + ' ' + data[2] + '\'s row.');
        });

        // Delete a record
        table.on('click', '.remove', function(e) {
            $tr = $(this).closest('tr');
            table.row($tr).remove().draw();
            e.preventDefault();
        });

        //Like record
        table.on('click', '.like', function() {
            alert('You clicked on Like button');
        });

        $('.card .material-datatables label').addClass('form-group');
    });

	$('.header_nav').removeClass('active');
	$('.report').addClass('active');
	$('#header_page_title').html('Attendance');
</script>

<script>
        $(document).ready(function () {
            showGraph();
        });

        function showGraph() {
            $.ajax({
                url: '/loadattendanceDatareport',
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                     //console.log(response);

                     var name = [];
                    var marks = [];

                     $.each(response, function(index, item) {
                       if (item.length > 0) {
                            for (let i = 0; i < item.length; i++) {
                                name.push(item[i][1]);
                                marks.push(item[i][0]);
                                //console.log(item[i][1]);
                             }
                         }
                    });

                    var chartdata = {
                        labels: name,
                        datasets: [
                            {
                                label: 'Attendance',
                                backgroundColor: '#49e2ff',
                                borderColor: '#46d5f1',
                                hoverBackgroundColor: '#CCCCCC',
                                hoverBorderColor: '#666666',
                                data: marks
                            }
                        ]
                    };

                    var graphTarget = $("#graphCanvas");

                    var barGraph = new Chart(graphTarget, {
                        type: 'bar',
                        data: chartdata
                    });

                },
                error: function(result){
                    console.log('no result!')
                }
            })
        }

        function showGraph1()
        {
            {
                $.post('/loadattendanceDatareport',
                function (data)
                {
                    console.log(data);
                     var name = [];
                    var marks = [];

                    for (var i in data) {
                        name.push(data[i].first_name);
                        marks.push(data[i].v);
                        console.log(data[i]);
                    }

                    var chartdata = {
                        labels: name,
                        datasets: [
                            {
                                label: 'Attendance',
                                backgroundColor: '#49e2ff',
                                borderColor: '#46d5f1',
                                hoverBackgroundColor: '#CCCCCC',
                                hoverBorderColor: '#666666',
                                data: marks
                            }
                        ]
                    };

                    var graphTarget = $("#graphCanvas");

                    var barGraph = new Chart(graphTarget, {
                        type: 'bar',
                        data: chartdata
                    });
                });
            }
        }

    $('.header_nav').removeClass('active');
	$('.report').addClass('active');
	$('#header_page_title').html('Attendance Report');
        </script>